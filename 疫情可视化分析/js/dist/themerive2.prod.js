"use strict";function themerive2(){svg=d3.select(".parallel .chart");function l(t){return g.indexOf(t["日期"])}function s(t){return t["市值"]}function f(t,a,n){var r=a.includes("C制造业")?d3.select("#maingroup"):d3.select("#manugroup"),e=d3.stack().keys(a).offset(d3.stackOffsetNone).order(d3.stackOrderNone)(t),i=r.append("clipPath").attr("id","rectClip").append("rect").attr("class","rect-clip").attr("width",0).attr("height",C);r.selectAll("path").data(e).join("path").attr("opacity",.9).attr("d",function(t,a){return n(t)}).attr("clip-path","url(#rectClip)").attr("fill",function(t,a){return B[t.key]}),i.transition().ease(d3.easeLinear).duration(2e3).attr("width",y)}function p(t){var a=[];return g.forEach(function(t){a.push({"日期":t})}),t.forEach(function(t){a[g.indexOf(t["日期"])][t["行业"]]=s(t)}),a}var m,h,x,g,t=+svg.attr("width"),a=+svg.attr("height"),v=100,A=120,y=t-A-120,C=a-v-100,E=4e3,k=1e3,B={"A农林牧渔":"#DD6B66","B采矿业":"#759AA0","C制造业":"#E69D87","D能源供应":"#8DC1A9","E建筑业":"#EA7E53","F批发零售":"#EEDD78","G交通邮储":"#73A373","H住宿餐饮":"#73B9BC","I信息技术":"#7289AB","J金融业":"#91CA8C","K房地产业":"#F49F42","L租赁商务":"#AA312C","M科研技术":"#39656D","N公共设施":"#B35E45","O居民服务":"#4B8E6F","P教育":"#B6481C","Q卫生社工":"#BBA838","R文体娱乐":"#386F38","S综合":"#388589"};d3.csv("csv/industry.csv").then(function(t){t.forEach(function(t){t["市值"]=+t["市值"]}),alldates=Array.from(new Set(t.map(function(t){return t["日期"]}))),alldates=alldates.sort(function(t,a){return new Date(a.date)-new Date(t.date)}),g=alldates;var n=[];alldates.forEach(function(t){n.push([])}),t.forEach(function(t){n[alldates.indexOf(t["日期"])].push(t)});for(var r=0,e=function(t){return t["市值"]};r<n.length;r++)n[r].forEach(function(a){a.newinfec_s=0==r?e(a):1==r?(e(a)+e(n[r-1].find(function(t){return t["行业"]===a["行业"]})))/2:(e(a)+e(n[r-1].find(function(t){return t["行业"]===a["行业"]}))+e(n[r-2].find(function(t){return t["行业"]===a["行业"]})))/3});data_manu=t.filter(function(t){return"C制造业"===t["行业"]}),t=t.filter(function(t){return"C制造业"!==t["行业"]});var a=p(t),i=p(data_manu),c=(c=n[n.length-1].sort(function(t,a){return a["市值"]-t["市值"]}).map(function(t){return t["行业"]})).filter(function(t){return"C制造业"!==t}),u=Array.from(new Set(data_manu.map(function(t){return t["行业"]})));k=d3.max(n,function(t){return result=0,t.forEach(function(t){"C制造业"!==t["行业"]&&(result+=s(t))}),result}),E=d3.max(n,function(t){return result=0,t.forEach(function(t){"C制造业"===t["行业"]&&(result+=s(t))}),result}),function(t){m=d3.scaleLinear().domain([0,g.length-1]).range([0,y]),h=d3.scaleLinear().domain([k,0,-E]).range([C,C/2,0]).nice(),x=d3.scaleLinear().domain([-k,0,E]).range([C,C/2,0]).nice(),m(d3.max(t,l)),h(d3.max(t,s));var a=svg.append("g").attr("transform","translate(".concat(A,", ").concat(v,")")).attr("id","maingroup");svg.append("g").attr("transform","translate(".concat(A,", ").concat(v,")")).attr("id","manugroup");var n=d3.format("0"),r=d3.axisLeft(h).tickSize(-y).tickFormat(function(t){return 0===t?0:(t<0&&(t=-t),n(t))}).tickPadding(10),e=d3.axisBottom(m).tickSize(-C).tickPadding(10).ticks(24),i=a.append("g").call(r).attr("id","yaxis");d3.selectAll("#yaxis .tick text").attr("transform","translate(".concat(0,", ",-3,")")),i.append("text").attr("transform","rotate(-90)").attr("x",-C/2).attr("y",-80).attr("fill","white").text("市值").attr("text-anchor","middle"),i.selectAll(".domain").remove();var c=a.append("g").call(e).attr("transform","translate(".concat(0,", ",C,")")).attr("id","xaxis");d3.selectAll("#xaxis .tick text").attr("transform","translate(".concat(0,", ",5,")")),c.append("text").attr("y",60).attr("x",y/2).attr("fill","white").text(" "),c.selectAll(".domain").remove();var u=["A农林牧渔","B采矿业","C制造业","D能源供应","E建筑业","F批发零售","G交通邮储","H住宿餐饮","I信息技术","J金融业","K房地产业","L租赁商务","M科研技术","N公共设施","O居民服务","P教育","Q卫生社工","R文体娱乐","S综合"],o=svg.selectAll(".legend").data(u).enter().append("g").attr("class","legend").attr("transform",function(t,a){return"translate("+(130+y)+","+(20*a+140)+")"});o.append("rect").data(u).attr("x",0).attr("y",0).attr("width",30).attr("height",15).style("fill",function(t,a){return B[t]}),o.append("text").data(u).attr("class","legend_text").attr("x",40).attr("y",9).attr("dy",".2em").attr("fill","#333333").style("text-anchor","start").text(function(t){return t})}(t);var o=d3.area().curve(d3.curveCardinal.tension(.3)).x(function(t){return m(l(t.data))}).y0(function(t){return h(t[0])}).y1(function(t){return h(t[1])}),d=d3.area().curve(d3.curveCardinal.tension(.3)).x(function(t){return m(l(t.data))}).y0(function(t){return x(t[0])}).y1(function(t){return x(t[1])});f(a,c,o),f(i,u,d)})}